<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            margin: 0;
            padding: 0;
            width: 100%;
            overflow-x: hidden;
            font-family: 'Figtree', Arial, sans-serif;
            background-color: #FAFAFA;
        }
        .details-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        @media (max-width: 480px) {
            .details-container {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        .more-details {
            display: flex;
            align-items: center;
        }
        .more-details img {
            margin-right: 10px;
        }
        .detail-text {
            display: flex;
            flex-direction: column;
        }
        .detail-result {
            font-weight: bold;
        }
        .detail-title {
            color: #555;
        }
        .more-information {
            display: flex;
            align-items: center;
            font-size: 12px;
            color: #007BFF;
            cursor: pointer;
            margin-top: 5px;
        }
        .more-information img {
            margin-right: 5px;
        }
    </style>
</head>
<body>
    <div id="container" class="details-container"></div>

    <script>
        async function fetchCarData(folderName) {
            try {
                const response = await fetch(`listings/${folderName}/data.json`);
                const jsonData = await response.json();
                const cc = parseInt(jsonData.MotorYTransmision.Cilindrada.CC, 10); // Parse cc as a number
                const kilowatts = parseFloat(jsonData.MotorYTransmision.Potencia.KW); // Parse kilowatts as a number
                return {
                    id: jsonData.JavaScriptInfo.id,
                    photoCount: jsonData.JavaScriptInfo.cantidadImágenes,
                    status: jsonData.JavaScriptInfo.estado,
                    make: jsonData.CaracteristicasGenerales.Marca,
                    model: jsonData.CaracteristicasGenerales.Modelo,
                    version: jsonData.CaracteristicasGenerales.Versión,
                    emissions: jsonData.ConsumoYEmisiones.Etiqueta,
                    emissionsAmount: jsonData.ConsumoYEmisiones.EmisionesCO2,
                    capacityCC: cc, // Store as a numeric value
                    capacityLiters: `${(Math.ceil(cc / 100) / 10).toFixed(1)}L`,
                    technology: jsonData.MotorYTransmision.Combustible.Tecnología,
                    colour: jsonData.CaracteristicasGenerales.Color,
                    body: jsonData.Carroceria.Tipo,
                    doors: jsonData.Carroceria.Puertas,
                    seats: jsonData.Carroceria.Plazas,
                    year: jsonData.CaracteristicasGenerales.Año,
                    transmission: jsonData.MotorYTransmision.Transmision.Caja,
                    gears: jsonData.MotorYTransmision.Transmision.Marchas,
                    kilometres: new Intl.NumberFormat('es-ES').format(jsonData.CaracteristicasGenerales.Kilometraje),
                    fuel: jsonData.MotorYTransmision.Combustible.Tipo,
                    consumption: new Intl.NumberFormat('es-ES').format(jsonData.ConsumoYEmisiones.Consumo.Medio),
                    kilowatts: kilowatts, // Store as a numeric value
                    horsepower: jsonData.MotorYTransmision.Potencia.CV,
                    price: parseFloat(jsonData.CaracteristicasGenerales.PrecioNuevo),
                    previousPrice: parseFloat(jsonData.CaracteristicasGenerales.PrecioAnterior),
                };
            } catch (error) {
                console.error(`Error fetching data for ${folderName}:`, error);
                return null;
            }
        }

        function createDetailDiv(containerId, icon, detailValue, detailTitle, moreInfoText) {
            const container = document.getElementById(containerId);

            // Create the outer div
            const moreDetailsDiv = document.createElement('div');
            moreDetailsDiv.className = 'more-details';

            // Create the image element
            const img = document.createElement('img');
            img.src = `icons/details/${icon}.svg`;
            img.alt = detailTitle;
            img.width = 48;
            img.height = 48;

            // Create the detail text div
            const detailTextDiv = document.createElement('div');
            detailTextDiv.className = 'detail-text';

            // Create the detail result span
            const detailResultSpan = document.createElement('span');
            detailResultSpan.className = 'detail-result';
            detailResultSpan.textContent = detailValue;

            // Create the detail title span
            const detailTitleSpan = document.createElement('span');
            detailTitleSpan.className = 'detail-title';
            detailTitleSpan.textContent = detailTitle;

            // Append spans to the detail text div
            detailTextDiv.appendChild(detailResultSpan);
            detailTextDiv.appendChild(detailTitleSpan);

            // Optionally create the more information label
            if (moreInfoText) {
                const moreInfoLabel = document.createElement('label');
                moreInfoLabel.className = 'more-information';
                moreInfoLabel.innerHTML = `<img src="icons/more-information.svg" alt="More information" width="12" height="12">${moreInfoText}`;
                detailTextDiv.appendChild(moreInfoLabel);
            }

            // Append image and detail text div to the outer div
            moreDetailsDiv.appendChild(img);
            moreDetailsDiv.appendChild(detailTextDiv);

            // Append the outer div to the container
            container.appendChild(moreDetailsDiv);
        }

        // Example usage
        fetchCarData('CAR001').then(carData => {
            if (carData) {
                createDetailDiv('container', 'kilometres', `${carData.kilometres} km`, 'Kilometres');
                createDetailDiv('container', 'horsepower', `${carData.horsepower} CV`, 'Horsepower');
                createDetailDiv('container', 'fuel', carData.fuel, 'Fuel Type');
                createDetailDiv('container', 'transmission', `${carData.transmission}`, 'Transmission');
                createDetailDiv('container', 'gears', `${carData.gears}`, 'Nº Gears');
                createDetailDiv('container', 'registration', `${carData.year}`, 'Car Registered'); // MAKE SURE TO UPDATE INCLUDING MONTH
                createDetailDiv('container', 'doors', carData.doors, 'Nº doors');
                createDetailDiv('container', 'seats', carData.seats, 'Nº Seats');
                createDetailDiv('container', 'colour', carData.colour, 'Colour Exterior');
                createDetailDiv('container', 'consumption', `${carData.consumption} l/100`, 'Fuel Consumption', 'See All'); // POPUP INFO
                createDetailDiv('container', 'emissions', `${carData.emissionsAmount} g/km`, 'Emissions CO2', 'More Information'); // MAKE SURE TO UPDATE BADGE TO SUIT EMMISIONS DATA MONTH + POPUP INFO
            }
        });
    </script>
</body>
</html>
