<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Appraisal Form</title>

    <link rel="stylesheet" href="style-new.css">
    <link rel="stylesheet" href="style-popup-forms.css">
    <link rel="icon" href="icons/company/favicon.ico" type="image/x-icon">

    <style>
        /* REMOVE ALL STYLE IF I DO NOT USE */
        /* style-new.css */
        .box-wrapper {
            background-color: #f2f2f2;
            margin: 2rem auto;
            max-width: 80rem;
            border-radius: 1rem;
        }

        #AppraisalForm {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
        }

        .input-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
        }

        /* Adjust for smaller screens (mobile) */
        @media (max-width: 768px) {
            #AppraisalForm {
                grid-template-columns: 1fr;
            }
        }
    </style>

</head>

<body>

    <div id="header-contact-container"></div>
    <div id="header-container"></div>
    <div id="header-banner-container"></div>


    <main id="valueMyCar" class="box-wrapper">


        <div id="googleMaps" style="width: 100%; height: 400px;">
            <iframe
                src="https://www.google.com/maps/embed?pb=!1m14!1m8!1m3!1d11664.826669712314!2d-7.5762373!3d43.037083!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0xd31ce5256c71689%3A0xc2eade902ecd0949!2sMart%C3%ADnez%20De%20Lugo%2C%20S.L.U.!5e0!3m2!1ses!2ses!4v1696847969220!5m2!1ses!2ses"
                width="100%" height="100%" style="border:0;" allowfullscreen="" loading="lazy"
                referrerpolicy="no-referrer-when-downgrade">
            </iframe>
        </div>



        <div class="main-block secpadding">
            <div class="section-isotope__header paddingT5">
                <div class="container">
                    <div class="row">
                        <div class="col-xs-12">
                            <div class="text-center">
                                <h2 class="ui-title-block">CONTÁCTANOS PARA LO QUE QUIERAS</h2>
                                <div class="ui-subtitle-block">
                                    <h2>Si tienes la más mínima duda sobre lo que sea, aqui tienes todas las formas de
                                        contactar
                                        con nosotros.<br></h2>
                                </div>
                                <div class="ui-decor"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container">
                <div class="row">
                    <div class="col-xs-12 col-md-8 col-md-offset-2">
                        <div class="infoCont marginB40">
                            <div class="text-center">
                                <h4 class="text-center marginT10">MARTINEZ DE LUGO</h4>
                                <ul class="list-unstyled">
                                    <li><i class="icon fa fa-map-marker"></i>Estrada de A Coruna, 50, 27003 - LUGO
                                        (LUGO)</li>
                                    <li><i class="icon fa fa-phone"></i><a href="tel:982809090" rel="nofollow"
                                            onclick="gtag_doit('L');">982 21 74 03</a>&nbsp;&nbsp;&nbsp;<i
                                            class="icon fa fa-mobile-phone"></i><a href="tel:698180002" rel="nofollow"
                                            onclick="gtag_doit('L');">982 21 74 03</a></li>
                                </ul>
                            </div>
                            <div class="text-center marginT40"><label>Horario</label>
                                <div class="">L - V: 9:00 - 13:30 y de 15:30 - 20:00<br> Sab: 10:00 -a 13:00</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>



            <section class="contact-section">
                <div class="contact-intro">
                    <p class="contact-description">Completa el formulario a continuación para
                        comunicarte con nosotros. Agradecemos tus comentarios y te responderemos lo
                        antes posible.</p>
                </div>
                <form id="contactUsForm">
                    <input type="hidden" name="access_key" value="fc184b2a-7c0d-4071-a665-e807c3f4e679">
                    <input type="hidden" name="subject" value="Contacto">
                    <input type="hidden" name="from_name" value="Car Dealership">



                    <input type="hidden" id="car_id" name="car_id" value="VO-00008">
                    <div class="input-box">
                        <input type="text" id="name" placeholder="Nombre *" aria-required="true" maxlength="30"
                            autocapitalize="none" autocorrect="off" name="name" required="">
                        <span for="name">Nombre *</span>
                    </div>
                    <div class="input-box">
                        <input type="email" id="email" placeholder="Correo electrónico *" aria-required="true"
                            maxlength="30" autocapitalize="none" autocorrect="off" name="email" required="">
                        <span for="email">Correo electrónico *</span>
                    </div>
                    <div class="input-box">
                        <input type="tel" id="phone" placeholder="Teléfono *" aria-required="true" maxlength="9"
                            autocapitalize="none" autocorrect="off" name="phone" inputmode="numeric" pattern="[0-9]*"
                            title="Por favor, ingresa un número de teléfono válido (solo números)" required="">
                        <span for="phone">Teléfono *</span>
                    </div>

                    <div class="input-box">
                        <label id="contact_us_char_count" for="contact_us_comments" class="form-label">Motivo del
                            contacto
                            (máx. 350 caracteres)</label>
                        <textarea id="contact_us_comments" name="contact_us_comments" class="form-textarea"
                            placeholder="Tu mensaje" rows="4" maxlength="350" required=""></textarea>
                    </div>

                    <div class="contact-intro">
                        <div class="form-check form-check--required">
                            <input type="checkbox" id="vehicle_send_to_friend_legal_policy_accept"
                                name="vehicle_send_to_friend[legal][policy_accept]" required="" class="form-check-input"
                                value="1">
                            <label for="vehicle_send_to_friend_legal_policy_accept" class="required">
                                Acepto la <a href="/privacy-policy.html" target="_blank" class="blue-link">política
                                    de privacidad</a>.
                            </label>
                        </div>
                        <div class="form-check form-check--optional">
                            <input type="checkbox" id="ads_accept" name="ads_accept" class="form-check-input" value="1">
                            <label for="ads_accept">
                                Acepto recibir ofertas y promociones de Martínez De Lugo, S.L.U.
                            </label>
                        </div>
                    </div>
                    <span class="button-box">
                        <button class="form-submit-button" type="submit" name="submit" disabled="">
                            Enviar Mensaje
                        </button>
                    </span>
                </form>
            </section>

        </div>

    </main>

    <footer id="footer-container"></footer>


    <script type="module">
        import { loadHeaderAndFooter } from './js/pageSetup.js';

        document.addEventListener('DOMContentLoaded', async () => {
            await loadHeaderAndFooter(); // Load header and footer asynchronously


            // Add event listeners to form submission
            const form = document.getElementById('contactUsForm');
            form.addEventListener('submit', handleFormSubmission);

            // Add input listeners to enable/disable the submit button
            addInputListeners(form);

            // Check if elements exist before adding event listeners for dynamic text updates
            const contactUsTextarea = document.getElementById('contact_us_comments');
            const contactUsCharCount = document.getElementById('contact_us_char_count');

            if (contactUsTextarea && contactUsCharCount) {
                contactUsTextarea.addEventListener('input', () => updateCharCount(contactUsTextarea, contactUsCharCount, 350));
            }
        });



        // Function to update character count
        function updateCharCount(textarea, charCountElement, maxLength) {
            const remaining = maxLength - textarea.value.length;
            charCountElement.textContent = `${charCountElement.getAttribute('for')} (${remaining} caracteres restantes)`;
        }


        // Function to check if all required fields in the form are filled out
        function checkFormValidity(form) {
            const requiredInputs = form.querySelectorAll('input[required], textarea[required]');
            const radioGroups = Array.from(requiredInputs)
                .filter(input => input.type === 'radio')
                .map(input => input.name);

            const allInputsFilled = Array.from(requiredInputs).every(input => input.value.trim() !== '');
            const allRadioSelected = radioGroups.every(name => form.querySelector(`input[name="${name}"]:checked`));

            const submitButton = form.querySelector('.form-submit-button');
            if (submitButton) {
                submitButton.disabled = !(allInputsFilled && allRadioSelected);
            }
        }

        // Function to check if an input field has content
        function checkInputHasContent(input) {
            input.classList.toggle('input-has-content', input.value.trim() !== '');
        }

        // Event listener to monitor input changes and update input styles
        function addInputListeners(form) {
            form.querySelectorAll('input, textarea, select').forEach(input => {
                input.addEventListener('input', () => {
                    checkInputHasContent(input);
                    checkFormValidity(form);
                });
                input.addEventListener('change', () => checkFormValidity(form));
            });
        }


        // Function to handle form submission
        async function handleFormSubmission(event) {
            event.preventDefault();

            const form = event.target;
            const formData = new FormData(form);

            // Extract contact details from form data
            const name = formData.get('name');
            const email = formData.get('email');
            const phone = formData.get('phone');
            const comments = formData.get('contact_us_comments');

            // Prepare the data to send
            const data = {
                access_key: formData.get('access_key'),
                subject: formData.get('subject'),
                from_name: formData.get('from_name'),
                message: `
                **Datos de contacto**
                - Nombre: ${name}
                - Correo electrónico: ${email}
                - Teléfono: ${phone}
                - Comentarios: ${comments}
            `
            };

            const submitButton = form.querySelector('.form-submit-button');
            if (submitButton) {
                submitButton.disabled = true;
                submitButton.textContent = 'Submitting...';
                submitButton.style.backgroundColor = '#007bff'; // Change to your desired color for submitting state
            }

            try {
                const response = await fetch('https://api.web3forms.com/submit', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                const json = await response.json();
                if (response.ok) {
                    if (submitButton) {
                        submitButton.textContent = '¡Enviado!';
                        submitButton.style.backgroundColor = '#28a745'; // Green color for success
                    }
                    setTimeout(() => window.history.back(), 2000);
                } else {
                    if (submitButton) {
                        submitButton.textContent = `La presentación falló: ${json.message}`;
                        submitButton.style.backgroundColor = '#dc3545'; // Red color for error
                    }
                    setTimeout(() => {
                        if (submitButton) {
                            submitButton.disabled = false;
                            submitButton.textContent = 'Enviar';
                            submitButton.style.backgroundColor = ''; // Reset to original color
                        }
                    }, 2000);
                }
            } catch (error) {
                console.error('Form submission error:', error); // Log the error
                if (submitButton) {
                    submitButton.textContent = '¡Algo salió mal!';
                    submitButton.style.backgroundColor = '#dc3545'; // Red color for error
                    setTimeout(() => {
                        submitButton.disabled = false;
                        submitButton.textContent = 'Enviar';
                        submitButton.style.backgroundColor = ''; // Reset to original color
                    }, 2000);
                }
            }
        }
    </script>
</body>

</html>