<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Used Cars Listings</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="icons/company/favicon.ico" type="image/x-icon">


    <link rel="stylesheet" href="style-new.css">
    <style>
        .resetFilterButton {
            display: none;
        }
        
        @media (max-width: 480px) {
            body {
                font-size: 15px;
            }
        }
    </style>
</head>

<body>
    <!-- Header -->
    <div id="header-contact-container"></div>
    <div id="header-container"></div>
    <div id="header-banner-container"></div>

    <div id="overlay" class="overlay" style="display: none;"></div>
    <div id="loanPopup" class="popup-container" style="display: none;"></div>

    <!-- Filter Section -->
    <section class="bg-vl-grey">
        <div class="listings-info">
            <label id="filterLabel" class="filter-label">
                <span id="filterLabelText" class="filter-text">All filters</span>
                <img src="icons/ui/actions/filter.svg" alt="Filter Icon" class="filter-icon">
            </label>
            <div id="filterPopup" class="popup-container" style="display: none;">
                <button class="resetFilterButton">Reset Filters</button>

                <div class="popup-title">
                    <div class="filter-text">All filters</div>
                    <button id="closeFilterPopup" class="close-button">
                        <img src="icons/ui/navigation/close.svg" alt="Close" width="20" height="20">
                    </button>
                </div>
                <div id="brand" class="filter-options-container"></div>
                <div id="fuel" class="filter-options-container"></div>
                <div id="body" class="filter-options-container"></div>
                <div id="emissions" class="filter-options-container"></div>
            </div>
        </div>
    </section>

    <!-- Sorting Section -->
    <section class="listings-info sort-dropdown">
        <div class="listing-count" id="listingCount">Loading...</div>
        <label id="sortLabel" class="sort-label">
            <img src="icons/ui/actions/sort.svg" alt="Sort Icon">
            <span id="sortLabelText" class="filter-text">Relevance</span>
        </label>
        <div id="sortPopup" class="popup-container" style="display: none;">
            <div class="popup-title">
                <div class="sort-text">Sort</div>
                <button id="closeSortPopup" class="close-button">
                    <img src="icons/ui/navigation/close.svg" alt="Close" width="20" height="20">
                </button>
            </div>
            <div id="sortOptionsContainer"></div>
        </div>
    </section>

    <button class="resetFilterButton">Reset Filters</button>

    <!-- Car Listings Section -->
    <section class="car-listings" id="carListings"></section>

    <div id="footer-container"></div>

</body>

<!-- Scripts -->
<script type="module">
    import { loadHeaderAndFooter } from './js/pageSetup.js';
    import { getAllCarData } from './js/carDataFetcher.js';
    import { renderCarListings, setFilteredCars } from './js/listingsManager.js';

    let carsData = [];

    document.addEventListener('DOMContentLoaded', async () => {
        try {
            await loadHeaderAndFooter(); // Load header and footer asynchronously

            // Fetch car data and initialize filteredCars with the fetched data
            carsData = await getAllCarData(false);
            setFilteredCars(carsData); // Use the setter function to set filteredCars

            // Call renderCarListings and pass carsData
            renderCarListings(false, carsData); // Pass carsData
        } catch (error) {
            console.error('Error initializing the page:', error);
        }
    });
</script>

</html>
